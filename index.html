<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>STARBLAST.IO</title>
        <style>
            @font-face {
                font-family: 'ROG LyonsType';
                font-style: normal;
                font-weight: 400;
                src: url('https://fonts.cdnfonts.com/s/91615/ROGLyonsTypeRegular3.woff') format('woff');
            }

            body {
                background: #000;
                background-image: url('./background.png');
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center center;
                background-attachment: fixed;
                display: flex;
                justify-content: center;
                margin: 0;
                font-family: Arial, sans-serif;
                user-select: none;
            }

            #logo {
                overflow: hidden;
                text-align: center;
                position: fixed;
                top: 0;
                opacity: 1;
                z-index: 2;
                width: 50vh;
                min-width: 150px;
            }

            #logo img {
                width: 100%;
                animation: fadeIn 1s ease-out;
            }

            .header {
                position: fixed;
                top: 35%;
                left: 0;
                right: 0;
                text-align: center;
                font-size: 4em;
                font-weight: bold;
                background: white;
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: 0 4px 12px rgb(255, 255, 255);
                animation: fadeIn 1s ease-out 0.5s backwards;
                font-family: 'ROG LyonsType';
                pointer-events: none;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: translate(-50%, -60px) scale(1);
                }
                50% {
                    transform: translate(-50%, -50px) scale(0.8);
                }
            }

            .all {
                height: 100%;
                width: 100%;
                display: flex;
                justify-content: center;
                overflow: hidden;
            }

            .selects {
                position: absolute;
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                width: 80vh;
                height: 50vh;
                gap: 20%;
                top: 50%;
                overflow: visible;
            }

            .box {
                position: relative;
            }

            .box span {
                display: inline-block;
                font-family: 'ROG LyonsType';
                color: white;
                font-size: 50px;
                text-shadow: 0px 0px 10px white;
                transition: all 0.2s ease;
            }

            .box:hover span {
                text-shadow: 10px -15px 10px white;
                transform: translateY(-10%);
                cursor: pointer;
            }

            #ecp:hover span {
                color: #cb5454;
                text-shadow: 10px -15px 10px rgb(205, 55, 55);
            }
            #browser {
                top: 20%;
            }

            #steam {
                top: -20%;
            }

            .triangle-svg {
                position: absolute;
                width: 50px;
                height: 50px;
                top: -10px;
                left: 50%;
                transform: translate(-50%, 0) scale(0);
                pointer-events: none;
                z-index: 10;
                filter: drop-shadow(0px 0px 15px rgba(255, 255, 255, 0.8)) drop-shadow(0px 5px 20px rgba(255, 255, 255, 0.4));
                transition: left 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.3s ease-out, transform 0.3s ease-out;
            }

            .triangle-svg.active {
                transform: translate(-50%, 0) scale(1);
            }

            .triangle-svg.bouncing {
                animation: bounce 0.8s ease-in-out infinite;
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: translate(-50%, 0) scale(1);
                }
                50% {
                    transform: translate(-50%, 10px) scale(0.8);
                }
            }
            .quit {
                display: flex;
                position: fixed;
                bottom: 2%;
                left: 2%;
                height: 4%;
                width: 7%;
                align-items: center;
                cursor: pointer;
            }

            .quit svg {
                opacity: 0;
                transform: translateX(0);
                transition: all 0.3s ease-in-out;
            }

            .quit:hover svg {
                opacity: 1;
                transform: translateX(260%);
            }

            .quit span {
                font-family: 'ROG LyonsType';
                color: white;
                font-size: 2em;
            }

            .settings {
                display: flex;
                position: fixed;
                left: 2%;
                top: 2%;
                height: 20%;
                width: 12%;
                pointer-events: none;
            }

            .settings svg {
                transition: all 0.3s ease-in-out;
                position: absolute;
                top: 0;
                bottom: 0;
                pointer-events: auto;
            }
            .settings svg:hover {
                transform: rotate(360deg);
            }

            .settings .settings-tab {
                display: none;
                flex-direction: column;
                gap: 5%;
                align-items: center;
                background-color: #7d7d7d75;
                border: 2px solid rgb(68, 98, 185);
                box-shadow: 0 0 10px rgb(68, 98, 185);
                border-radius: 12px;
                height: 70%;
                width: 100%;
                position: absolute;
                left: 80px;
                text-align: center;
                backdrop-filter: blur(4.1px);
                padding: 4%;
                pointer-events: auto;
            }

            .settings .settings-tab::before {
                content: '';
                position: absolute;
                left: -25px;
                top: 5%;
                border: 12px solid transparent;
                border-right-color: rgb(68, 98, 185);
            }

            .settings .settings-tab div {
                display: flex;
                justify-content: center;
                width: 100%;
            }

            .settings .settings-tab div span {
                align-content: center;
            }

            label {
                margin-left: 4%;
            }

            .switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 34px;
            }

            .switch input {
                display: none;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                -webkit-transition: 0.4s;
                transition: 0.4s;
                border-radius: 20px;
            }

            .slider:before {
                position: absolute;
                content: '';
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                -webkit-transition: 0.4s;
                transition: 0.4s;
                border-radius: 50%;
            }

            input:checked + .slider {
                background-color: #00ff00;
            }

            input:focus + .slider {
                box-shadow: 0 0 1px hsl(200, 60%, 30%);
            }

            input:checked + .slider:before {
                -webkit-transform: translateX(26px);
                -ms-transform: translateX(26px);
                transform: translateX(26px);
            }
            input[type='text'] {
                border: none;
                border-bottom: 2px solid black;
                background-color: transparent;
                outline: 0;
                width: 85%;
            }
        </style>
    </head>

    <body>
        <audio src="https://starblast.data.neuronality.com/music/civilisation.mp3" loop autoplay style="display: none"></audio>
        <div id="logo"><img src="logo.svg" /></div>
        <h1 class="header">SELECT PLATFORM</h1>

        <div class="all">
            <div class="settings">
                <svg width="50px" height="50px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="white">
                    <path
                        d="M9.1 4.4L8.6 2H7.4l-.5 2.4-.7.3-2-1.3-.9.8 1.3 2-.2.7-2.4.5v1.2l2.4.5.3.8-1.3 2 .8.8 2-1.3.8.3.4 2.3h1.2l.5-2.4.8-.3 2 1.3.8-.8-1.3-2 .3-.8 2.3-.4V7.4l-2.4-.5-.3-.8 1.3-2-.8-.8-2 1.3-.7-.2zM9.4 1l.5 2.4L12 2.1l2 2-1.4 2.1 2.4.4v2.8l-2.4.5L14 12l-2 2-2.1-1.4-.5 2.4H6.6l-.5-2.4L4 13.9l-2-2 1.4-2.1L1 9.4V6.6l2.4-.5L2.1 4l2-2 2.1 1.4.4-2.4h2.8zm.6 7c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM8 9c.6 0 1-.4 1-1s-.4-1-1-1-1 .4-1 1 .4 1 1 1z" />
                </svg>
                <div class="settings-tab">
                    <div class="music">
                        <span>Background Music</span>
                        <label class="switch">
                            <input type="checkbox" id="music-check" />
                            <div class="slider"></div>
                        </label>
                    </div>
                    <input type="text" id="music-input" placeholder="music link" />
                    <div class="reduce-motion">
                        <span>Reduce Motion</span>
                        <label class="switch">
                            <input type="checkbox" />
                            <div class="slider"></div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="selects">
                <svg width="50" height="50" viewBox="0 0 50 50" class="triangle-svg" id="triangle">
                    <path d="M 25 45 L 5 5 L 45 5 Z" fill="white" stroke="white" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" />
                </svg>

                <div class="box" id="browser" onclick="window.electronAPI.sendMessage('start-browser')">
                    <span>Browser</span>
                </div>
                <div class="box" id="ecp" onclick="window.electronAPI.sendMessage('start-ecp')">
                    <span>ECP</span>
                </div>
                <div class="box" id="steam" onclick="window.electronAPI.sendMessage('start-steam')">
                    <span>Steam</span>
                </div>
            </div>
        </div>
        <div class="quit" onclick="window.electronAPI.sendMessage('quit-app')">
            <svg fill="white" width="50px" height="50px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M4,12a1,1,0,0,0,1,1h7.59l-2.3,2.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l4-4a1,1,0,0,0,.21-.33,1,1,0,0,0,0-.76,1,1,0,0,0-.21-.33l-4-4a1,1,0,1,0-1.42,1.42L12.59,11H5A1,1,0,0,0,4,12ZM17,2H7A3,3,0,0,0,4,5V8A1,1,0,0,0,6,8V5A1,1,0,0,1,7,4H17a1,1,0,0,1,1,1V19a1,1,0,0,1-1,1H7a1,1,0,0,1-1-1V16a1,1,0,0,0-2,0v3a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V5A3,3,0,0,0,17,2Z" />
            </svg>
            <span>Exit</span>
        </div>

        <script>
            const triangle = document.getElementById('triangle');
            const boxes = document.querySelectorAll('.box');
            const selects = document.querySelector('.selects');
            let currentHoveredBox = null;
            let hideTimeout = null;

            boxes.forEach(box => {
                box.addEventListener('mouseenter', function () {
                    currentHoveredBox = box;

                    if (hideTimeout) {
                        clearTimeout(hideTimeout);
                        hideTimeout = null;
                    }

                    const boxRect = box.getBoundingClientRect();
                    const selectsRect = selects.getBoundingClientRect();
                    const relativeLeft = boxRect.left - selectsRect.left + boxRect.width / 2;
                    const relativeTop = boxRect.top - selectsRect.top - 100;

                    triangle.style.left = relativeLeft + 'px';
                    triangle.style.top = relativeTop + 'px';
                    triangle.classList.add('active', 'bouncing');
                });

                box.addEventListener('mouseleave', function () {
                    currentHoveredBox = null;

                    hideTimeout = setTimeout(() => {
                        if (currentHoveredBox === null) {
                            triangle.classList.remove('active', 'bouncing');
                        }
                    }, 500);
                });
            });

            selects.addEventListener('mouseleave', function () {
                currentHoveredBox = null;

                hideTimeout = setTimeout(() => {
                    triangle.classList.remove('active', 'bouncing');
                }, 500);
            });
            document.addEventListener('DOMContentLoaded', () => {
                console.log('DOM loaded');
                const DEFAULT_MUSIC_URL = 'https://starblast.data.neuronality.com/music/civilisation.mp3';
                const checkbox = document.getElementById('music-check');
                const input = document.getElementById('music-input');
                input.style.display = checkbox.checked ? 'block' : 'none';

                checkbox.addEventListener('change', () => {
                    input.style.display = checkbox.checked ? 'block' : 'none';
                });
                const settingsContainer = document.querySelector('.settings');
                const settingsTab = document.querySelector('.settings-tab');
                const settingsSvg = document.querySelector('.settings svg');
                let hideTimeout;

                if (settingsContainer && settingsTab && settingsSvg) {
                    settingsSvg.addEventListener('mouseenter', () => {
                        clearTimeout(hideTimeout);
                        settingsTab.style.display = 'flex';
                    });

                    settingsContainer.addEventListener('mouseleave', () => {
                        hideTimeout = setTimeout(() => {
                            settingsTab.style.display = 'none';
                        }, 100);
                    });

                    settingsContainer.addEventListener('mouseenter', () => {
                        clearTimeout(hideTimeout);
                    });
                }

                const musicCheckbox = document.getElementById('music-check');
                const musicInput = document.getElementById('music-input');

                if (musicCheckbox && musicInput) {
                    musicInput.style.display = musicCheckbox.checked ? 'block' : 'none';

                    musicCheckbox.addEventListener('change', () => {
                        musicInput.style.display = musicCheckbox.checked ? 'block' : 'none';

                        if (!musicCheckbox.checked) {
                            stopBackgroundMusic();
                        } else {
                            const url = musicInput.value.trim() || DEFAULT_MUSIC_URL;
                            playBackgroundMusic(url);
                        }
                    });
                }

                let errorMessage = null;

                const SUPPORTED_FORMATS = ['mp3', 'wav', 'ogg', 'webm', 'm4a', 'aac', 'flac'];

                function getFileExtension(url) {
                    try {
                        const urlObj = new URL(url);
                        const pathname = urlObj.pathname;
                        const pathWithoutQuery = pathname.split('?')[0];
                        const extension = pathWithoutQuery.split('.').pop().toLowerCase();
                        return extension;
                    } catch (e) {
                        return null;
                    }
                }

                function showError(message) {
                    removeError();

                    errorMessage = document.createElement('div');
                    errorMessage.className = 'music-error';
                    errorMessage.textContent = message;
                    errorMessage.style.cssText = `
                color: #ff4444;
                background-color: rgba(255, 68, 68, 0.1);
                border: 1px solid #ff4444;
                border-radius: 8px;
                padding: 8px;
                margin-top: 5px;
                font-size: 12px;
                text-align: center;
                animation: fadeIn 0.3s ease-in-out;
            `;

                    musicInput.parentElement.appendChild(errorMessage);

                    setTimeout(removeError, 5000);
                }

                function removeError() {
                    if (errorMessage && errorMessage.parentElement) {
                        errorMessage.remove();
                        errorMessage = null;
                    }
                }

                function getAudioElement() {
                    return document.querySelector('audio');
                }

                function stopBackgroundMusic() {
                    const audio = getAudioElement();
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                }

                function playBackgroundMusic(url) {
                    if (!url || url.trim() === '') {
                        return;
                    }

                    const extension = getFileExtension(url);

                    if (!extension || !SUPPORTED_FORMATS.includes(extension)) {
                        showError(`Unsupported format. Supported: ${SUPPORTED_FORMATS.join(', ')}`);
                        return;
                    }

                    removeError();

                    const audio = getAudioElement();

                    if (!audio) {
                        showError('No audio element found in DOM');
                        return;
                    }

                    audio.src = url;
                    audio.loop = true;
                    audio.volume = 0.5;

                    const newAudio = audio.cloneNode(true);
                    audio.parentNode.replaceChild(newAudio, audio);

                    newAudio.addEventListener('error', e => {
                        let errorMsg = 'Error loading music';

                        if (newAudio.error) {
                            switch (newAudio.error.code) {
                                case MediaError.MEDIA_ERR_ABORTED:
                                    errorMsg = 'Loading was aborted';
                                    break;
                                case MediaError.MEDIA_ERR_NETWORK:
                                    errorMsg = 'Network error while loading';
                                    break;
                                case MediaError.MEDIA_ERR_DECODE:
                                    errorMsg = 'File could not be decoded';
                                    break;
                                case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:
                                    errorMsg = 'File format not supported or URL invalid';
                                    break;
                            }
                        }

                        showError(errorMsg);
                        stopBackgroundMusic();
                    });

                    newAudio.play().catch(err => {
                        showError('URL invalid, please try again');
                        console.error('Play error:', err);
                    });
                }

                if (musicInput) {
                    musicInput.addEventListener('change', () => {
                        if (musicCheckbox.checked) {
                            const url = musicInput.value.trim() || DEFAULT_MUSIC_URL;
                            playBackgroundMusic(url);
                        }
                    });

                    musicInput.addEventListener('keypress', e => {
                        if (e.key === 'Enter' && musicCheckbox.checked) {
                            const url = musicInput.value.trim() || DEFAULT_MUSIC_URL;
                            playBackgroundMusic(url);
                        }
                    });
                }

                const reduceMotionCheckbox = document.querySelector('.reduce-motion input[type="checkbox"]');
                const styleElement = document.createElement('style');
                styleElement.id = 'reduce-motion-style';
                document.head.appendChild(styleElement);

                function updateReduceMotion(enabled) {
                    if (enabled) {
                        styleElement.textContent = `
                    *, *::before, *::after {
                        animation-duration: 0s !important;
                        animation-delay: 0s !important;
                        transition-duration: 0s !important;
                        transition-delay: 0s !important;
                    }
                `;
                    } else {
                        styleElement.textContent = '';
                    }
                }

                if (reduceMotionCheckbox) {
                    updateReduceMotion(reduceMotionCheckbox.checked);

                    reduceMotionCheckbox.addEventListener('change', () => {
                        updateReduceMotion(reduceMotionCheckbox.checked);
                    });
                }

                function saveSettings() {
                    localStorage.setItem('musicEnabled', musicCheckbox.checked);
                    localStorage.setItem('musicUrl', musicInput.value);
                    localStorage.setItem('reduceMotion', reduceMotionCheckbox.checked);
                }

                function loadSettings() {
                    const musicEnabled = localStorage.getItem('musicEnabled') === 'true';
                    const musicUrl = localStorage.getItem('musicUrl') || '';
                    const reduceMotion = localStorage.getItem('reduceMotion') === 'true';

                    if (musicCheckbox) {
                        musicCheckbox.checked = musicEnabled;
                        musicInput.style.display = musicEnabled ? 'block' : 'none';
                    }

                    if (musicInput) {
                        musicInput.value = musicUrl;
                        if (musicEnabled) {
                            const url = musicUrl || DEFAULT_MUSIC_URL;
                            playBackgroundMusic(url);
                        } else {
                            stopBackgroundMusic();
                        }
                    }

                    if (reduceMotionCheckbox) {
                        reduceMotionCheckbox.checked = reduceMotion;
                        updateReduceMotion(reduceMotion);
                    }
                }

                loadSettings();

                if (musicCheckbox) musicCheckbox.addEventListener('change', saveSettings);
                if (musicInput) musicInput.addEventListener('change', saveSettings);
                if (reduceMotionCheckbox) reduceMotionCheckbox.addEventListener('change', saveSettings);
            });
        </script>
    </body>
</html>
